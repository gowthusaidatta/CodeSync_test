<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Coding Profile Stats - Results</title>

    <!-- Preload critical resources -->
    <link rel="preload" href="https://cdn.tailwindcss.com" as="script">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" as="style">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“Š</text></svg>">

    <style>
        /* Custom CSS for the results page */
        :root {
            --color-primary: #6366f1; /* Indigo */
            --color-secondary: #8b5cf6; /* Violet */
            --color-text: #e2e8f0; /* Light Slate */
            --color-background-start: #1a202c; /* Dark Blue Gray */
            --color-background-end: #2d3748; /* Medium Blue Gray */
            --color-card-bg: rgba(255, 255, 255, 0.08);
            --color-card-border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--color-background-start), var(--color-background-end));
            display: flex;
            flex-direction: column; /* Arrange items vertically */
            align-items: center;
            justify-content: flex-start; /* Align to the top */
            min-height: 100vh;
            padding: 2rem 1rem; /* Responsive padding */
            color: var(--color-text);
            box-sizing: border-box; /* Include padding in element's total width and height */
        }

        .container {
            width: 100%;
            max-width: 1200px; /* Max width for content */
            margin: 0 auto; /* Center the container */
            padding: 1rem;
            box-sizing: border-box;
        }

        .glass-card {
            background: var(--color-card-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--color-card-border);
            border-radius: 1.5rem;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            padding: 2rem;
            margin-bottom: 1.5rem; /* Space between cards */
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); /* Responsive grid */
            gap: 1.5rem; /* Gap between grid items */
            width: 100%;
        }

        .result-card {
            background: var(--color-card-bg);
            backdrop-filter: blur(15px);
            border: 1px solid var(--color-card-border);
            border-left: 5px solid var(--color-primary); /* Left border for accent */
            border-radius: 1.5rem;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 200px; /* Ensure cards have a minimum height */
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }

        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px 0 rgba(0, 0, 0, 0.4);
        }

        .platform-icon {
            width: 48px;
            height: 48px;
            margin-right: 1rem;
            border-radius: 0.5rem;
            object-fit: contain; /* Ensure the image fits within its bounds */
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-weight: 500;
            color: #cbd5e1; /* Slate 300 */
        }

        .stat-value {
            font-weight: 600;
            color: var(--color-primary);
        }

        /* Platform specific colors for left border */
        .leetcode-card { border-left-color: #ffa116; } /* LeetCode orange */
        .codechef-card { border-left-color: #5b4636; } /* CodeChef brown */
        .hackerrank-card { border-left-color: #2cc97e; } /* HackerRank green */
        .gfg-card { border-left-color: #388e3c; } /* GFG dark green */

        /* Back button styling */
        .back-button {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-top: 2rem; /* Space above the button */
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        /* Responsive adjustments for smaller screens */
        @media (max-width: 768px) {
            .glass-card, .result-card {
                padding: 1.5rem;
            }
            .platform-icon {
                width: 40px;
                height: 40px;
            }
            h1 {
                font-size: 2.5rem; /* Smaller heading on mobile */
            }
            h2 {
                font-size: 1.75rem; /* Smaller subheadings */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-white text-4xl md:text-5xl font-extrabold text-center mb-8">
            Your Coding Profile Stats
        </h1>

        <div id="results-grid" class="result-grid">
            <!-- Results will be dynamically loaded here -->
        </div>

        <div id="no-profiles-message" class="glass-card hidden">
            <p class="text-lg text-gray-400">
                No coding profiles were provided. Please go back and enter your usernames.
            </p>
        </div>

        <!-- Back button links to usernames.html -->
        <a href="usernames.html" class="back-button">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
            </svg>
            Go Back
        </a>
    </div>

    <script>
        // Configuration for each platform, including logos and placeholder images
        const platformConfigs = {
            leetcode: {
                name: 'LeetCode',
                logo: 'https://assets.leetcode.com/static_assets/public/images/LeetCode_Sharing.png',
                placeholder: 'https://placehold.co/48x48/6366f1/ffffff?text=LC',
                color: 'leetcode-card'
            },
            codechef: {
                name: 'CodeChef',
                logo: 'https://www.codechef.com/sites/all/themes/abacus/logo.png',
                placeholder: 'https://placehold.co/48x48/5b4636/ffffff?text=CC',
                color: 'codechef-card'
            },
            hackerrank: {
                name: 'HackerRank',
                logo: 'https://www.hackerrank.com/wp-content/uploads/2023/07/hackerrank_logo.png',
                placeholder: 'https://placehold.co/48x48/2cc97e/ffffff?text=HR',
                color: 'hackerrank-card'
            },
            gfg: {
                name: 'GeeksforGeeks',
                logo: 'https://media.geeksforgeeks.org/wp-content/cdn-uploads/gfg_favicon.png',
                placeholder: 'https://placehold.co/48x48/388e3c/ffffff?text=GFG',
                color: 'gfg-card'
            }
        };

        // Function to render a success card for a platform
        function renderSuccessCard(platform, username, data, config) {
            const card = document.createElement('div');
            card.className = `result-card ${config.color}`;

            let statsHtml = '';
            // Dynamically add stats based on the data received
            for (const key in data) {
                // Capitalize the first letter of the key for display
                const label = key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1').trim();
                statsHtml += `
                    <div class="stat-item">
                        <span class="stat-label">${label}:</span>
                        <span class="stat-value">${data[key]}</span>
                    </div>
                `;
            }

            card.innerHTML = `
                <div class="flex items-center mb-5">
                    <img src="${config.logo}"
                         onerror="this.onerror=null;this.src='${config.placeholder}'"
                         class="platform-icon"
                         alt="${config.name} Logo">
                    <h2 class="text-2xl font-bold">${config.name}</h2>
                    <span class="ml-auto bg-slate-800/50 px-3 py-1 rounded-full text-sm font-mono text-slate-300">@${username}</span>
                </div>
                <div class="flex-grow">
                    ${statsHtml}
                </div>
            `;
            document.getElementById('results-grid').appendChild(card);
        }

        // Function to render an error card for a platform
        function renderErrorCard(platform, username, config) {
            const card = document.createElement('div');
            card.className = `result-card ${config.color} border-l-red-500`;

            card.innerHTML = `
                <div class="flex items-center mb-5">
                    <img src="${config.logo}"
                         onerror="this.onerror=null;this.src='${config.placeholder}'"
                         class="platform-icon"
                         alt="${config.name} Logo">
                    <h2 class="text-2xl font-bold">${config.name}</h2>
                    <span class="ml-auto bg-slate-800/50 px-3 py-1 rounded-full text-sm font-mono text-slate-300">@${username}</span>
                </div>
                <div class="text-red-400 flex items-center text-lg font-medium">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                    </svg>
                    Failed to fetch data or user not found.
                </div>
                <p class="text-sm text-gray-500 mt-2">Please check the username and your internet connection.</p>
            `;
            document.getElementById('results-grid').appendChild(card);
        }

        // Function to simulate fetching data from an API
        async function fetchProfileData(platform, username) {
            // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, Math.random() * 1000 + 500));

            // Simulate success or failure
            const isSuccess = Math.random() > 0.2; // 80% success rate for demonstration

            if (isSuccess) {
                // Return mock data for demonstration
                switch (platform) {
                    case 'leetcode':
                        return {
                            problemsSolved: Math.floor(Math.random() * 1000) + 100,
                            rank: Math.floor(Math.random() * 50000) + 1000,
                            easy: Math.floor(Math.random() * 200) + 10,
                            medium: Math.floor(Math.random() * 300) + 20,
                            hard: Math.floor(Math.random() * 100) + 5
                        };
                    case 'codechef':
                        return {
                            rating: Math.floor(Math.random() * 2000) + 1000,
                            globalRank: Math.floor(Math.random() * 100000) + 5000,
                            contests: Math.floor(Math.random() * 50) + 5
                        };
                    case 'hackerrank':
                        return {
                            badges: Math.floor(Math.random() * 30) + 5,
                            points: Math.floor(Math.random() * 5000) + 1000,
                            challengesSolved: Math.floor(Math.random() * 200) + 20
                        };
                    case 'gfg':
                        return {
                            problemsSolved: Math.floor(Math.random() * 800) + 50,
                            articlesWritten: Math.floor(Math.random() * 10) + 1,
                            contributions: Math.floor(Math.random() * 500) + 50
                        };
                    default:
                        return {};
                }
            } else {
                throw new Error('Failed to fetch data');
            }
        }

        // Main function to process query parameters and display results
        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const profilesToFetch = [];

            // Identify which platforms have usernames provided
            for (const [platform, config] of Object.entries(platformConfigs)) {
                const username = urlParams.get(platform);
                if (username) {
                    profilesToFetch.push({ platform, username, config });
                }
            }

            const resultsGrid = document.getElementById('results-grid');
            const noProfilesMessage = document.getElementById('no-profiles-message');

            if (profilesToFetch.length === 0) {
                noProfilesMessage.classList.remove('hidden');
                resultsGrid.classList.add('hidden');
            } else {
                noProfilesMessage.classList.add('hidden');
                resultsGrid.classList.remove('hidden');

                // Fetch and render data for each profile concurrently
                for (const { platform, username, config } of profilesToFetch) {
                    try {
                        const data = await fetchProfileData(platform, username);
                        renderSuccessCard(platform, username, data, config);
                    } catch (error) {
                        console.error(`Error fetching ${platform} data for ${username}:`, error);
                        renderErrorCard(platform, username, config);
                    }
                }
            }
        });
    </script>
</body>
</html>
