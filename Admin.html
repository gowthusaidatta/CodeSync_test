<!DOCTYPE html>
<html>
<head>
  <title>Admin View - CodeSyncUsers</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/aws-amplify@4.3.27/dist/aws-amplify.min.js"></script>
</head>
<body class="bg-gray-100 text-gray-900 p-6">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold mb-6 text-center">👨‍💻 Admin Panel - DynamoDB Users</h1>

    <div id="status" class="text-center text-red-600 mb-4"></div>

    <div class="overflow-x-auto">
      <table class="min-w-full bg-white border rounded-lg shadow">
        <thead class="bg-blue-600 text-white">
          <tr>
            <th class="px-4 py-2">Username</th>
            <th class="px-4 py-2">Email</th>
            <th class="px-4 py-2">LeetCode</th>
            <th class="px-4 py-2">CodeChef</th>
            <th class="px-4 py-2">HackerRank</th>
            <th class="px-4 py-2">GFG</th>
            <th class="px-4 py-2">Last Login</th>
          </tr>
        </thead>
        <tbody id="userTable" class="text-center"></tbody>
      </table>
    </div>
  </div>

  <script type="module">
    import { DynamoDBClient, ScanCommand } from "https://cdn.skypack.dev/@aws-sdk/client-dynamodb";
    import { unmarshall } from "https://cdn.skypack.dev/@aws-sdk/util-dynamodb";

    const REGION = "us-east-1"; // ✅ your region
    const tableName = "CodeSyncUsers";

    const client = new DynamoDBClient({
      region: REGION,
      credentials: {
        accessKeyId: "AKIAYNVNWLFMDV7U4V5T",     // ❗ NEVER use in real frontend
        secretAccessKey: "QEFWd5iBkL14rS1JIn5/bGICGrkRnobSEkB4xbeN"  // ❗ NEVER expose secrets
      }
    });

    const status = document.getElementById("status");
    const table = document.getElementById("userTable");

    async function loadUsers() {
      try {
        const command = new ScanCommand({ TableName: tableName });
        const response = await client.send(command);
        const users = response.Items.map(item => unmarshall(item));

        users.forEach(user => {
          table.innerHTML += `
            <tr class="border-b">
              <td class="px-4 py-2">${user.username || "-"}</td>
              <td class="px-4 py-2">${user.email || "-"}</td>
              <td class="px-4 py-2">${user.leetcode || "-"}</td>
              <td class="px-4 py-2">${user.codechef || "-"}</td>
              <td class="px-4 py-2">${user.hackerrank || "-"}</td>
              <td class="px-4 py-2">${user.geeksforgeeks || "-"}</td>
              <td class="px-4 py-2">${user.lastLoginTime || "-"}</td>
            </tr>`;
        });

      } catch (err) {
        status.textContent = "❌ Failed to load DynamoDB data: " + err.message;
      }
    }

    loadUsers();
  </script>
</body>
</html>
